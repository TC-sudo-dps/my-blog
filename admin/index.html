<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>TC Blog Admin | æ–‡ç« ç™¼ä½ˆç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #00d2ff; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); color: var(--text); padding: 40px 5%; margin: 0; }
        .admin-panel { max-width: 900px; margin: 0 auto; background: var(--card); padding: 40px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); }
        h1 { color: var(--primary); margin-top: 0; text-align: center; letter-spacing: 2px; }
        .field-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #94a3b8; font-size: 0.9rem; }
        input, select, textarea { width: 100%; padding: 14px; border-radius: 10px; border: 1px solid #334155; background: #0f172a; color: white; font-size: 1rem; transition: 0.3s; }
        input:focus, textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 10px rgba(0, 210, 255, 0.2); }
        textarea { height: 450px; font-family: 'Fira Code', monospace; line-height: 1.6; resize: vertical; }
        .hint { background: rgba(0, 210, 255, 0.1); color: var(--primary); padding: 12px; border-radius: 8px; font-size: 0.85rem; margin-bottom: 20px; text-align: center; }
        button { width: 100%; padding: 16px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; background: var(--primary); color: #0f172a; }
        button:hover { opacity: 0.9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 210, 255, 0.3); }
        .status { text-align: center; margin-top: 15px; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="admin-panel">
    <h1>TC BLOG ç®¡ç†å¾Œå°</h1>
    
    <div class="hint">
        ğŸš€ å·²åµæ¸¬åˆ° Tokenï¼šæ¬Šé™å·²å•Ÿç”¨ <br>
        ğŸ’¡ æ”¯æ´ Ctrl + V ç›´æ¥è²¼ä¸Šæˆªåœ– (è‡ªå‹•è½‰ç‚º Base64 ç¢¼)
    </div>

    <div class="field-group">
        <label>æ–‡ç« æ¨™é¡Œ</label>
        <input type="text" id="title" placeholder="è«‹è¼¸å…¥æ¨™é¡Œ...">
    </div>

    <div class="field-group">
        <label>é¸æ“‡åˆ†é¡</label>
        <select id="category">
            <option value="æŠ€è¡“">æŠ€è¡“</option>
            <option value="è³‡å®‰">è³‡å®‰</option>
            <option value="ç”Ÿæ´»">ç”Ÿæ´»</option>
            <option value="éš¨ç­†">éš¨ç­†</option>
        </select>
    </div>

    <div class="field-group">
        <label>æ–‡ç« å…§å®¹ (Markdown)</label>
        <textarea id="content" placeholder="åœ¨æ­¤æ’°å¯«æ–‡ç« å…§å®¹..."></textarea>
    </div>

    <button onclick="publishPost()" id="pubBtn">ğŸš€ æ­£å¼ç™¼ä½ˆæ–‡ç« åˆ° GitHub</button>
    <div id="status" class="status"></div>
</div>

<script>
    // ä½ çš„ GitHub Token (å·²ç›´æ¥å¯«å…¥)
    const GH_TOKEN = "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";
    const GH_REPO = "TC-sudo-dps/my-blog";

    const contentArea = document.getElementById('content');
    const statusDiv = document.getElementById('status');

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šCtrl + V è²¼åœ– ---
    contentArea.addEventListener('paste', function (e) {
        const items = (e.clipboardData || e.originalEvent.clipboardData).items;
        for (let item of items) {
            if (item.type.indexOf('image') !== -1) {
                const blob = item.getAsFile();
                const reader = new FileReader();
                reader.onload = function (event) {
                    const imgMarkdown = `\n![åœ–ç‰‡](${event.target.result})\n`;
                    const start = contentArea.selectionStart;
                    const end = contentArea.selectionEnd;
                    contentArea.value = contentArea.value.substring(0, start) + imgMarkdown + contentArea.value.substring(end);
                };
                reader.readAsDataURL(blob);
                e.preventDefault();
            }
        }
    });

    // --- ç™¼ä½ˆåŠŸèƒ½ ---
    async function publishPost() {
        const title = document.getElementById('title').value;
        const category = document.getElementById('category').value;
        const content = document.getElementById('content').value;
        const btn = document.getElementById('pubBtn');

        if (!title || !content) {
            alert('æ¨™é¡Œå’Œå…§å®¹éƒ½è¦å¡«å–”ï¼');
            return;
        }

        btn.disabled = true;
        btn.innerText = "ç™¼ä½ˆä¸­ï¼Œè«‹ç¨å€™...";
        statusDiv.innerText = "æ­£åœ¨ä¸Šå‚³è‡³ GitHub...";

        const fileName = `${Date.now()}.md`;
        const dateStr = new Date().toISOString().split('T')[0];
        
        const fullMarkdown = `---
title: "${title}"
category: "${category}"
date: "${dateStr}"
---

${content}`;

        // è½‰ç‚º Base64
        const base64Content = btoa(unescape(encodeURIComponent(fullMarkdown)));
        const url = `https://api.github.com/repos/${GH_REPO}/contents/posts/${fileName}`;

        try {
            const res = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GH_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Publish post: ${title}`,
                    content: base64Content
                })
            });

            if (res.ok) {
                statusDiv.style.color = "#00ffcc";
                statusDiv.innerText = "ğŸ‰ ç™¼ä½ˆæˆåŠŸï¼æ–‡ç« å·²åŒæ­¥è‡³éƒ¨è½æ ¼ã€‚";
                alert('ç™¼ä½ˆæˆåŠŸï¼');
                document.getElementById('title').value = '';
                document.getElementById('content').value = '';
            } else {
                const err = await res.json();
                statusDiv.style.color = "#ff4d4d";
                statusDiv.innerText = "ç™¼ä½ˆå¤±æ•—ï¼š" + err.message;
            }
        } catch (e) {
            statusDiv.style.color = "#ff4d4d";
            statusDiv.innerText = "é€£ç·šç•°å¸¸ï¼š" + e.message;
        } finally {
            btn.disabled = false;
            btn.innerText = "ğŸš€ æ­£å¼ç™¼ä½ˆæ–‡ç« åˆ° GitHub";
        }
    }
</script>
</body>
</html>
